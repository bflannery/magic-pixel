{"version":3,"file":"index.js","sources":["../node_modules/tslib/tslib.es6.js","../src/utils.ts","../src/contentIdentification.ts","../src/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","function scriptIsHTML(script: HTMLOrSVGScriptElement): script is HTMLScriptElement {\n  return 'src' in script\n}\n\nexport function getSiteId(script: HTMLOrSVGScriptElement | null): string | null {\n  if (window.MP_SID) {\n    return window.MP_SID\n  }\n  if (!script) {\n    console.error('MP: script requires being loaded from mp source')\n    return null\n  }\n  if (!scriptIsHTML(script)) {\n    console.error('MP: mp does not support SVG scripts.')\n    return null\n  }\n\n  const url = new URL(script.src)\n  return url.searchParams.get('sid')\n}\n\nexport function getDiffFromTimestamp(time1: number, time2: number, scope: 'days' | 'hours' | 'mins'): number {\n  const timeDiff = time1 - time2\n\n  if (scope === 'days') {\n    return timeDiff / (1000 * 3600 * 24)\n  } else if (scope === 'hours') {\n    return timeDiff / (60 * 60 * 1000)\n  } else {\n    return timeDiff / (60 * 1000)\n  }\n}\n\nexport function uuidv4(): string {\n  var s4 = function () {\n    return Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1)\n  }\n\n  return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4()\n}\n\nexport function formatFieldKey(key: string): string {\n  return key.replace(/[_-]/g, '').toLocaleLowerCase()\n}\n\nexport function isValidEmail(email: string) {\n  const emailRegex = /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/\n  return email.match(emailRegex)\n}\n\nexport const isChildLink = (ancestors: Element[]) => {\n  let isChildLink = false\n  for (let i = 0; i < ancestors.length; i++) {\n    const element = ancestors[i]\n    if (element.tagName == 'A') {\n      isChildLink = true\n    }\n  }\n  return isChildLink\n}\n\nexport interface toObjectInterface {\n  [key: string]: any\n}\n\nexport const toObject = (olike: toObjectInterface) => {\n  const o: toObjectInterface = {}\n  let key\n\n  for (key in olike) {\n    o[key] = olike[key]\n  }\n\n  return o\n}\n\nconst isObject = (object: object): boolean => {\n  return object != null && typeof object === 'object'\n}\n\nexport const deepEqual = (object1: toObjectInterface, object2: toObjectInterface): boolean => {\n  const keys1 = Object.keys(object1)\n  const keys2 = Object.keys(object2)\n  if (keys1.length !== keys2.length) {\n    return false\n  }\n  for (const key of keys1) {\n    const val1 = object1[key]\n    const val2 = object2[key]\n    const areObjects = isObject(val1) && isObject(val2)\n    if ((areObjects && !deepEqual(val1, val2)) || (!areObjects && val1 !== val2)) {\n      return false\n    }\n  }\n  return true\n}\n\nexport const undup = function (f: Function, cutoff?: number) {\n  cutoff = cutoff || 250\n\n  var lastInvoked = 0\n  return function () {\n    var curTime = new Date().getTime()\n    var delta = curTime - lastInvoked\n\n    if (cutoff && delta > cutoff) {\n      lastInvoked = curTime\n\n      return f.apply(null, arguments)\n    } else {\n      return undefined\n    }\n  }\n}\n\nexport const parseQueryString = (qs: string): object => {\n  const pairs: toObjectInterface = {}\n\n  if (qs.length > 0) {\n    const query = qs.charAt(0) === '?' ? qs.substring(1) : qs\n\n    if (query.length > 0) {\n      const vars = query.split('&')\n      for (let i = 0; i < vars.length; i++) {\n        if (vars[i].length > 0) {\n          const pair = vars[i].split('=')\n\n          try {\n            const name = decodeURIComponent(pair[0])\n            pairs[name] = pair.length > 1 ? decodeURIComponent(pair[1]) : 'true'\n          } catch (e) {\n            console.error(e)\n          }\n        }\n      }\n    }\n  }\n  return pairs\n}\n\nexport interface ParsedURLProps {\n  href: string | null\n  hash: string | null\n  host: string | null\n  hostname: string | null\n  pathname: string | null\n  protocol: string | null\n  query: toObjectInterface\n}\n\nexport const parseUrl = (url: string) => {\n  const link = document.createElement('a')\n  link.href = url\n  if (link.host === '') {\n    link.host = link.href\n  }\n  return {\n    href: link.href,\n    hash: link.hash,\n    host: link.host,\n    hostname: link.hostname,\n    pathname: link.pathname,\n    protocol: link.protocol,\n    query: parseQueryString(link.search),\n  }\n}\n\nexport const parseLocation = (location: Location): ParsedURLProps => {\n  return {\n    href: location.href,\n    hash: location.hash,\n    host: location.host,\n    hostname: location.hostname,\n    pathname: location.pathname,\n    protocol: location.protocol,\n    query: parseQueryString(location.search),\n  }\n}\n\nexport const isSamePage = (url1: string, url2: string) => {\n  const url1Object: ParsedURLProps = parseUrl(url1)\n  const url2Object: ParsedURLProps = parseUrl(url2)\n\n  // Ignore the hash when comparing to see if two pages represent the same resource:\n  return (\n    url1Object.protocol === url2Object.protocol &&\n    url1Object.host === url2Object.host &&\n    url1Object.pathname === url2Object.pathname &&\n    deepEqual(url1Object.query, url2Object.query)\n  )\n}\n","import { getAncestors } from './dom'\nimport { ParsedURLProps, parseLocation } from './utils'\n\n\nexport default class ContentIdentification {\n  url: ParsedURLProps | null\n\n  constructor() {\n    this.url = null\n\n  }\n\n  async init() {\n    console.debug('MP: Initializing Content Identification')\n\n    // Check the url\n    this.url = parseLocation(document.location)\n    this.addVideoEventListeners()\n    this.addScrollDepthListeners()\n    this.addFormEventListeners()\n\n    console.log({ ContentIdentification: this })\n  }\n\n\n  async trackIdentifiedContent(): Promise<boolean> {\n    try {\n      const MP = window.MP\n      if (!MP) {\n        console.error('MP: No MP instance exists.')\n        return false\n      }\n      console.log(`Track Identified Content Request Body:`, { pageType: {} })\n      await MP.apiRequest('POST', 'identification/content', {})\n      return true\n    } catch(e) {\n      console.error(`Error tracking page: ${e}`)\n      return false\n    }\n  }\n\n  addScrollDepthListeners(): void {\n    window.addEventListener(\"scroll\", (event) => {\n      // console.log({ scrollEvent: event })\n    })\n\n    window.onscroll = function(){\n      const top =\tdocument.documentElement.scrollTop;\n      // console.log({ top })\n    };\n  }\n\n  addVideoEventListeners(): void {\n    // Search for video elements\n    const videos = document.querySelectorAll('video')\n\n    // // Search for external video libraries\n    // const videoJsVideos = document.querySelectorAll('video-js')\n\n    const allVideoElements = [...Array.from(videos)]\n    allVideoElements.map(videoElement => {\n      console.log({ videoElement })\n      videoElement.onplay = (event) => {\n        console.log({ onPlayEvent: event });\n      }\n      videoElement.onpause = (event) => {\n        console.log({ onPauseEvent: event });\n      }\n    })\n  }\n\n  addFormEventListeners(): void {\n    const forms = document.querySelectorAll('form')\n    const allFormElements = [...Array.from(forms)]\n    allFormElements.map(formElement => {\n      console.log({ formElement })\n      formElement.oninput = (event) => {\n        console.log({ onInputEvent: event })\n      }\n      formElement.onsubmit = (event) => {\n        console.log({ onSubmitEvent: event })\n        debugger\n      }\n\n    })\n  }\n}\n","import { getSiteId } from './utils'\nimport ContentIdentification from './contentIdentification'\n\nconst script = document.currentScript\n\n/**\n * @function: init\n * @description: When page is ready, validates script and account status\n * before loading scribe-analytics tracking and page identification services\n */\nasync function init() {\n\n  // Get site id from script for validation\n  const siteId = getSiteId(script)\n  if (!siteId) {\n    console.error('MP: Error verifying account. No site id provided')\n    return false\n  }\n\n  const MP = window.MP\n  if (!MP) {\n    console.error('MP: No MP object found on window')\n    return false\n  }\n\n  // Check if account is active\n  const accountIsActive = await MP.authenticateAccount()\n  if (accountIsActive) {\n    console.debug('MP: Account is active.')\n\n    // Create new MP class and add to window\n    const ContentId = new ContentIdentification()\n    window.MP_ContentIdentification = ContentId\n\n    // Initialize MP class\n    await ContentId.init()\n\n  } else {\n    console.error(`MP: Account is not active for site id ${siteId}.`)\n  }\n}\n\n// Wait until all elements are on the pageIdentification from initial load\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init)\n} else {\n  init().then(() => 'Successfully initiated ContentIdentification Pixel')\n}\n"],"names":[],"mappings":"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"}